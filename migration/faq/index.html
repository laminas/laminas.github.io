<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="FAQ for Laminas migrations.">

    <link rel="apple-touch-icon" sizes="180x180" href="https://getlaminas.org/images/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://getlaminas.org/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://getlaminas.org/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="https://getlaminas.org/images/favicon/site.webmanifest">
    <link rel="mask-icon" href="https://getlaminas.org/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="https://getlaminas.org/images/favicon/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="https://getlaminas.org/images/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <title>Laminas Migration FAQ</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body id="page-top" data-spy="scroll" data-target=".toc" data-offset="20">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container">
        <a class="logo-link navbar-brand" href="https://getlaminas.org/" data-tooltip data-placement="bottom" title="Go to the Laminas homepage">
            <img src="https://docs.laminas.dev/img/laminas-foundation-white.svg" height="28" alt="Laminas">
        </a>
        <a class="navbar-title" href="https://docs.laminas.dev/" data-tooltip
           data-placement="bottom" title="Go to the Laminas Documentation">
            Documentation
        </a>

        <button type="button"
                class="navbar-toggler"
                data-toggle="collapse"
                data-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent"
                aria-expanded="false"
                aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <div class="dropdown sub-project-selector">
                        <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false">
                            All Docs
                        </a>
                        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                            <a href="https://docs.mezzio.dev/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="/img/laminas-mezzio-rgb.svg" alt="Laminas Mezzio">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Mezzio</strong><br>
                                        PSR-15 Middleware in Minutes
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/components/" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="/img/laminas-components-rgb.svg" alt="Laminas Components">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>Components</strong><br>
                                        Components for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <a href="https://docs.laminas.dev/mvc" class="dropdown-item">
                                <div class="row align-items-center">
                                    <div class="col-md-4 col-sm-12">
                                        <img src="/img/laminas-mvc-rgb.svg" alt="Laminas MVC">
                                    </div>
                                    <div class="col-md-8 col-sm-12">
                                        <strong>MVC</strong><br>
                                        MVC for Enterprise Applications
                                    </div>
                                </div>
                            </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/migration/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Migration to Laminas
                                    </div>
                                </div>
                            </a>
                            <a class="dropdown-item dropdown-item--secondardy" href="https://docs.laminas.dev/tutorials/">
                                <div class="row align-items-center">
                                    <div class="col-md-8 offset-md-4 col-sm-12">
                                        Tutorials
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </li>
                <li class="nav-item">
                    <a href="https://getlaminas.org/participate" class="nav-link">Community</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<header class="header">
    <div class="container">
        <div class="row">
            <div class="col-md-6 col-sm-12">
                <h1 class="header__title">
                    Migration to Laminas
                    <small class="header__subtitle">FAQ</small>
                </h1>
            </div>
        </div>
    </div>
</header>

<div class="container"><div class="row">
    <main class="col-md-9 col-sm-12 content">

        <div class="toc">
            <h6 class="toc__headline">On this page</h6>

            <ul class="toc__list">
                <li class="toc__entry"><a class="toc__link nav-link" href="#memory-limit">Removing the PHP Memory Limit When Migrating</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#module-and-config-post-processor-injection">Module and Config Post Processor Injection</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#alias-rewrites-and-3rd-party-packages">Alias Rewrites</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#clear-your-caches">Clear Your Caches</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#migrating-with-a-zendframework-zendframework-package">Migrating with a zendframework/zendframework package</a></li>
                <li class="toc__entry"><a class="toc__link nav-link" href="#zend-framework-v1-considerations">Zend Framework v1 Considerations</a></li>
            </ul>
        </div>

        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Overview</a></li>
                <li class="breadcrumb-item"><a href="/migration/">Migration to Laminas</a></li>
                <li class="breadcrumb-item active" aria-current="page">FAQ</li>
            </ol>
        </nav>

        <h1>FAQ</h1>

<h2 id="memory-limit">Removing the PHP Memory Limit When Migrating</h2>

<p>
    In some cases when running the migration tooling, you may run into a fatal
    error indicating the PHP <code>memory_limit</code> has been reached.
</p>

<p>
    To resolve this, you will need to run the <code>laminas-migration</code>
    tool through the PHP interpreter.
</p>

<p>
    First, determine where the script lives:
</p>

<pre class="codehilite"><code class="language-bash">$ which laminas-migration</code></pre>

<p>
    Next, when invoking the command, invoke it as follows:
</p>

<pre class="codehilite"><code class="language-bash">$ php -d memory_limit=-1 path/to/bin/laminas-migration # and any arguments you need</code></pre>

<p>
    This will disable the memory limit, which should allow your script to finish
    successfully.
</p>

<h2 id="module-and-config-post-processor-injection">Module and Config Post Processor injection</h2>

<p>
    If you are migrating an MVC, Apigility, or Expressive application to Laminas,
    the migration tooling attempts to inject some code in your application. This can
    fail if you have non-standard configuration.
</p>

<h3 id="migrating-mvc-and-apigility-applications">Migrating MVC and Apigility applications</h3>

<p>
    When migrating MVC and Apigility applications to Laminas MVC and Laminas API
    Tools, the migration tooling attempts to add <code>Laminas\ZendFrameworkBridge</code> as a
    module to the top of the <code>config/modules.config.php</code> file. If injection fails,
    add the module in a way appropriate to your application.
</p>

<h3 id="expressive">Expressive</h3>

<p>
    When migrating Expressive applications to Mezzio, the migration tooling attempts
    to add <code>Laminas\ZendFrameworkBridge\ConfigPostProcessor</code> as a post processor
    class to the <code>ConfigAggregator</code> constructor. The <code>ConfigAggregator</code> constructor
    has the following signature:
</p>

<pre class="codehilite"><code class="language-php">public function __construct(
    array $providers = [],
    ?string $cachedConfigFile = null,
    array $postProcessors = []
)</code></pre>

<p>
    Typically, the structure of the <code>config/config.php</code> file in Expressive and
    Mezzio applications looks like the following:
</p>

<pre class="codehilite"><code class="language-php">$cacheConfig = [
    'config_cache_path' => 'data/cache/app_config.php',
];

$aggregator = new ConfigAggregator([
    // config providers from 3rd party code
    // ...

    // App-specific modules
    // ...

    // Include cache configuration
    new ArrayProvider($cacheConfig),

    // Load application config in a pre-defined order in such a way that local settings
    // overwrite global settings. (Loaded as first to last):
    //   - `global.php`
    //   - `*.global.php`
    //   - `local.php`
    //   - `*.local.php`
    new PhpFileProvider('config/autoload/{{,*.}global,{,*.}local}.php'),

    // Load development config if it exists
    new PhpFileProvider('config/development.config.php'),
], $cacheConfig['config_cache_path']);

return $aggregator->getMergedConfig();</code></pre>

<p>As such, the migration tooling rewrites the second to last line to read:</p>

<pre class="codehilite"><code class="language-php">], $cacheConfig['config_cache_path'], [\Laminas\ZendFrameworkBridge\ConfigPostProcessor::class]);</code></pre>

<p>
    In most cases, failure to inject means that the individual arguments have
    been pushed to their own line. In such cases, add the third argument as
    detailed above.
</p>

<p>
    In other cases, applications may already be using post processors. If so,
    add <code>\Laminas\ZendFrameworkBridge\ConfigPostProcessor::class</code> to the list of
    post processors.
</p>

<h2 id="alias-rewrites-and-3rd-party-packages">Alias Rewrites and 3rd Party Packages</h2>

<p>
    While we have made huge efforts to prevent the migration tooling from
    clobbering your own code, there is two scenarios where we often cannot avoid
    it: when importing a namespace, and then referencing a class via that
    namespace; and when using 3rd party packages that reference legacy names.
</p>

<p>
    As an example of the first scenario, consider the following usage of a class
    from the zendframework/zend-expressive-authorization-acl package:
</p>

<pre class="codehilite"><code class="language-php" data-trim>
use Zend\Expressive\Authorization\Acl;

// And later:
$acl = new Acl\ZendAcl();
</code></pre>

<p>
    The code above imports the <code>Zend\Expressive\Authorization\Acl</code>
    namespace, and then later instantiates a class relative to that namespace.
    Migration will rewrite this to:
</p>

<pre class="codehilite"><code class="language-php" data-trim>
use Mezzio\Authorization\Acl;

// And later:
$acl = new Acl\ZendAcl();
</code></pre>

<p>
    The latter line is incorrect at this point; it should read <code>new
    Acl\LaminasAcl();</code>. You will need to check for such scenarios either
    via your test suite, or manually. The <a href="http://man7.org/linux/man-pages/man1/grep.1.html">grep</a>
    tool or your IDE's "find" functionality can help you identify these; search
    for "Zend" in your codebase after a migration).
</p>

<p>
    For the second scenario, sometimes 3rd party packages use the term "Zend",
    "ZF", "Apigility", or "Expressive" in their namespaces or class names:
</p>

<pre class="codehilite"><code class="language-php" data-trim>
use Some\Vendor\ZendAcl;

// And later:
$acl = new ZendAcl();
</code></pre>

<p>
    In the above example, a class name from a 3rd party package contains the
    word "Zend" in it. After migration, this becomes:
</p>

<pre class="codehilite"><code class="language-php" data-trim>
use Some\Vendor\ZendAcl;

// And later:
$acl = new LaminasAcl();
</code></pre>

<p>
    The above is now incorrect, as it's referring to a class that is not
    imported and thus does not exist. These sorts of changes are harder to
    locate. Make sure you review your diffs closely, and that you have an
    adequate test suite, to ensure that the code is exercised; this is the best
    way to ensure you can catch these changes.
</p>

<h2 id="clear-your-caches">Clear your caches</h2>

<p>
    If your application is not running in development mode, you will need to clear
    any configuration caches you have before testing. If you are using
    zf-development-mode (which becomes laminas-development-mode!), try enabling
    development mode:
</p>

<pre class="codehilite"><code class="language-bash">$ composer development-enable</code></pre>

<p>Expressive/Mezzio users can use the <code>clear-config-cache</code> command:</p>

<pre class="codehilite"><code class="language-bash">$ composer clear-config-cache</code></pre>

<h2 id="migrating-with-a-zendframework-zendframework-package">Migrating With A zendframework/zendframework Package</h2>

<p>
    If you have chosen to install the package zendframework/zendframework in
    your application, or if you started your project from the skeleton
    application before the 3.0 release, you will have some extra steps
    post-migration.
</p>

<p>
    First, please make sure you <strong>use version 1.2.0 or later of
    laminas-migration</strong>. That version provides some important updates
    that ensure that your zendframework/zendframework package is migrated
    to the correct Laminas packages.
</p>

<p>
    Afterwards, we recommend that you remove any packages you are not explicitly
    using from your project, per the following steps.
</p>

<h3>Identify Packages You Use</h3>

<p>
    The first step is to <strong>identify which individual packages</strong>
    you actually consume. 
</p>

<p>
    From a *nix or Mac command-line, you can run code similar to the following
    to get a list of uniquely imported classes:
</p>

<pre class="codehilite"><code class="language-bash">
$ grep -rP 'use Laminas' {source code directories} | uniq | sort
</code></pre>

<p>
    Where <code>{source code directories}</code> can be one or more of <code>src/</code>,
    <code>modules/</code>, <code>config/</code>, <code>bin/</code>,
    <code>public/</code> etc., but NOT <code>vendor/</code>. You will want to
    ensure every such directory is listed. If you are using an IDE, you may be
    able to do a project-wide search.
</p>

<p>
    The above will provide a list of namespaces and classes that you are
    importing in your project. From there, you can match those namespaces to the
    appropriate package. As examples:
</p>

<ul>
    <li><code>Laminas\Mvc\Controller\AbstractController</code> would translate to
        the laminas/laminas-mvc package.</li>
    <li><code>Laminas\Form\Form</code> would translate to the laminas/laminas-form package.</li>
    <li><code>Laminas\Navigation\Page\Mvc</code> would translate to the
        laminas/laminas-navigation package.</li>
    <li><code>Laminas\ApiTools\ContentNegotiation\JsonModel</code> would translate to the
        laminas-api-tools/api-tools-content-negotiation package.</li>
    <li>And so on.</li>
</ul>

<h3>Remove Old Dependencies</h3>

<p>
    Once you have your list of packages that you use, do the following:
    your application:
</p>

<ul>
    <li>Open your <code>composer.json</code> file, and look for any entries
        related to Laminas packages, and make a list of any Laminas packages 
        that are not in the list you compiled in the previous step.</li>
    <li>Run <code>composer remove {package}</code> for each of these
        packages.</li>
</ul>

<p>
    Once done, commit your <code>composer.json</code> and
    <code>composer.lock</code> file.
</p>

<h2 id="zend-framework-v1-considerations">Zend Framework v1 Considerations</h2>

<p>
    <a href="https://framework.zend.com/blog/2016-06-28-zf1-eol.html">Zend Framework version 1 is past end of life</a>, so it does not receive any rewrites during migration. However, custom code in the project being migrated does receive rewrites. This has the potential to cause errors.
</p>

<h3 id="zend-mail-v1">Zend_Mail</h3>

<p>
    The <code>Zend_Mail</code> component uses a "ZendMail_" prefix for filenames generated by the <code>Zend_Mail_Transport_File</code> transport. After migration, this transport adapter will continue to generate filenames using the "ZendMail_" prefix. Any custom code that also references the "ZendMail_" prefix will be rewritten to instead use a prefix of "LaminasMail_".
</p>

<p>
    Since the v1 <code>Zend_Mail</code> component and later versions both use the same "ZendMail_" prefix, the migration cannot discriminate when rewriting custom project code. Consequently, you will need to reconcile any errors in your code arising from this prefix rewrite.
</p>


        </main>

        <div class="col-md-3 col-sm-12 sidebar">
            <div class="subnavigation hidden-print">
                <h4 class="subnavigation__title"><a href="/migration/">Migration to Laminas</a></h4>

                <ul class="subnavigation__list">
                    <li class="subnavigation__list-item">
                        <a class="subnavigation__link" href="/migration/">Introduction</a>
                    </li>
                    <li class="subnavigation__list-item subnavigation__list-item--active">
                        <a class="subnavigation__link" href="./">FAQ</a>
                    </li>
                </ul>
            </div>
        </div>
</div></div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <h5>Laminas</h5>
                <ul>
                    <li>Laminas Project <a href="https://getlaminas.org/">The new foundation for the community-supported, open source continuation of Zend Framework</a></li>
                    <li>Laminas Components and MVC <a href="https://docs.laminas.dev/">Components and MVC for enterprise applications</a></li>
                    <li>Mezzio <a href="https://docs.mezzio.dev/">PSR-15 middleware in minutes</a></li>
                    <li>Maintenance Overview <a href="https://getlaminas.org/packages-maintenance-status/">Current maintenance status of Laminas &amp; Mezzio packages</a></li>
                </ul>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.laminas.dev" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://laminas.dev/chat" class="support__link" title="Chat"><i class="fab fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/laminas" class="support__link" title="Github"><i class="fab fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://phpc.social/@getlaminas" class="support__link" title="Mastodon"><i class="fab fa-mastodon"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://getlaminas.org/blog/rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://getlaminas.org/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>

            <div class="col-md-6">
                <h4 class="footer__headline">Copyright</h4>
                <p>
                    &copy; 2019 - present by <a href="https://getlaminas.org/">Laminas Project</a> a Series of LF Projects, LLC.
                </p>
            </div>
        </div>
    </div>
</footer>

<script>
    let base_url = '/',
        project = 'mvc',
        siteName = 'Documentation';
</script>
<script src="/js/scripts.js"></script>
</body>
</html>
